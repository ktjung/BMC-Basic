<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC 채굴 수익 계산기</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 30px;
      max-width: 700px;
      margin: auto;
      transition: background 0.3s, color 0.3s;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }

    label {
      margin-top: 10px;
      margin-bottom: 5px;
      display: block;
      font-weight: bold;
    }

    .row-3 {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .row-3 > div {
      flex: 1;
    }

    .hashrate-selection {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }

    .button-container {
      display: flex;
      flex-direction: row;
      gap: 4%;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .button-container button {
      flex: 1 1 48%;
      padding: 12px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: background-color 0.2s ease, transform 0.1s ease;
    }

    .button-container button:hover {
      transform: scale(1.02);
    }

    .calculate-btn {
      background-color: #4CAF50;
    }

    .exchange-btn {
      background-color: #008CBA;
    }

    .result {
      background-color: #e2e8f0;
      padding: 15px;
      margin-top: 20px;
      border-radius: 5px;
      transition: all 0.4s ease;
      opacity: 0;
      transform: translateY(20px);
    }

    .result.show {
      opacity: 1;
      transform: translateY(0);
    }

    canvas {
      margin-top: 30px;
      width: 100% !important;
      height: auto !important;
      max-height: 400px;
    }

    #exchangeModal {
      display: block;
      position: fixed;
      top: 25%;
      left: 50%;
      transform: translate(-50%, -200%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      width: 350px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    #exchangeModal.open {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, 0);
    }

    #exchangeModal p {
      font-size: 16px;
      margin: 10px 0;
    }

    #exchangeModal button {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-size: 15px;
      margin-top: 15px;
      cursor: pointer;
    }

    #exchangeModal button:hover {
      background-color: #d32f2f;
    }

    /* 슬라이드 스위치 스타일 */
    .switch {
      position: relative;
      display: inline-block;
      width: 34px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 50px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 12px;
      width: 12px;
      border-radius: 50px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
    }

    input:checked + .slider {
      background-color: #4CAF50;
    }

    input:checked + .slider:before {
      transform: translateX(14px);
    }

    /* 반응형 */
    @media (max-width: 600px) {
      .row-3 {
        flex-direction: column;
      }

      .row-3 > div {
        width: 100%;
      }

      .button-container {
        flex-direction: column;
      }

      .button-container button {
        width: 100%;
        margin-bottom: 10px;
      }
    }

    /* 다크모드 */
    body.dark-mode {
      background: #1e1e1e;
      color: #f1f1f1;
    }

    body.dark-mode input,
    body.dark-mode select {
      background: #2a2a2a;
      color: #f1f1f1;
      border: 1px solid #444;
    }

    body.dark-mode .result,
    body.dark-mode #exchangeModal,
    body.dark-mode .info-modal {
      background-color: #2c2c2c;
      color: #fff;
      border-color: #555;
    }

    body.dark-mode .calculate-btn {
      background-color: #388e3c;
    }

    body.dark-mode .exchange-btn {
      background-color: #1976d2;
    }

    body.dark-mode #exchangeModal button,
    body.dark-mode .info-modal button {
      background-color: #c62828;
    }

    body.dark-mode #exchangeModal button:hover,
    body.dark-mode .info-modal button:hover {
      background-color: #b71c1c;
    }

    body.dark-mode canvas {
      background-color: #1e1e1e;
    }

    body.dark-mode .button-container button {
      box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
    }

    /* 설명 모달 스타일 */
    .info-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      z-index: 1001;
      width: 350px;
      text-align: center;
    }

    .info-modal.show {
      display: block;
    }

    .info-modal button {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-size: 15px;
      margin-top: 15px;
      cursor: pointer;
    }

    .info-modal button:hover {
      background-color: #d32f2f;
    }
  </style>
</head>
<body>

<div style="text-align: right; margin-bottom: 10px;">
  <label style="cursor: pointer;">
    🌙 다크모드
    <label class="switch">
      <input type="checkbox" id="darkToggle" />
      <span class="slider"></span>
    </label>
  </label>
</div>

<h2>BTC 채굴 수익 계산기</h2>

<div class="hashrate-selection">
  <label><input type="radio" name="hashrate_unit" value="TH/s" checked> TH/s</label>
  <label><input type="radio" name="hashrate_unit" value="GH/s"> GH/s</label>
  <label><input type="radio" name="hashrate_unit" value="MH/s"> MH/s</label>
</div>

<input type="number" id="hashrate" value="670" placeholder="해시레이트" />

<div class="row-3">
  <div>
    <label>전기 요금 ($/kWh)<span class="info-icon" onclick="showInfoModal('electricity')" style="color: #edb0b0;">ⓘ</span></label>
    <input type="number" id="electricity" value="0.036" />
  </div>
  <div>
    <label>전력 소비량 (kW/TH)<span class="info-icon" onclick="showInfoModal('power')" style="color: #edb0b0;">ⓘ</span></label>
    <input type="number" id="power" value="0.019" />
  </div>
  <div>
    <label>사용 시간 (h)<span class="info-icon" onclick="showInfoModal('hours')" style="color: #edb0b0;">ⓘ</span></label>
    <input type="number" id="hours" value="24" />
  </div>
</div>

<label>풀 수수료 (%)<span class="info-icon" onclick="showInfoModal('fee')" style="color: #edb0b0;">ⓘ</span></label>
<input type="number" id="fee" value="0" />

<label>장비 가격 ($)<span class="info-icon" onclick="showInfoModal('hardware_cost')" style="color: #edb0b0;">ⓘ</span></label>
<input type="number" id="hardware_cost" value="10500" />

<div class="button-container">
  <button class="calculate-btn" onclick="calculate()">계산하기</button>
  <button class="exchange-btn" onclick="openModal()">환율 확인</button>
</div>

<div class="result" id="output">
  <p><strong>BTC 가격:</strong> $<span id="btc_price"></span></p>
  <p><strong>일일 채굴량 (BTC):</strong> <span id="daily_btc"></span> BTC</p>
  <p><strong>월간 / 연간 채굴량:</strong> <span id="monthly_btc"></span> BTC / <span id="yearly_btc"></span> BTC</p>
  <p><strong>일일 수익 (전기요금 -전):</strong> $<span id="daily_rev"></span></p>
  <p><strong>일일 전기 요금:</strong> $<span id="daily_cost"></span></p>
  <p><strong>일일 순이익:</strong> $<span id="daily_profit"></span></p>
  <p><strong>ROI (투자 회수기간):</strong> <span id="roi"></span> 일</p>
</div>

<canvas id="profitChart"></canvas>

<div id="exchangeModal">
  <p><strong>실시간 환율 (USD → KRW):</strong> ₩<span id="exchangeRateDisplay"></span></p>
  <p><strong>일일 순이익 (KRW):</strong> ₩<span id="dailyProfitKrw"></span></p>
  <p><strong>월간 순이익 (KRW):</strong> ₩<span id="monthlyProfitKrw"></span></p>
  <p><strong>연간 순이익 (KRW):</strong> ₩<span id="yearlyProfitKrw"></span></p>
  <button onclick="closeModal()">닫기</button>
</div>

<!-- 설명 모달 -->
<div id="infoModal" class="info-modal">
  <p id="infoText"></p>
  <button onclick="closeInfoModal()">닫기</button>
</div>

<script>
let chart;
let latestProfitUsd = 0;
let currentROI = null;

async function fetchBTCPrice() {
  const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
  const data = await res.json();
  return data.bitcoin.usd;
}

async function fetchExchangeRate() {
  const res = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
  const data = await res.json();
  return data.rates.KRW;
}

function getHashrateUnit() {
  return document.querySelector('input[name="hashrate_unit"]:checked').value;
}

async function calculate() {
  const hashrate = parseFloat(document.getElementById("hashrate").value);
  const powerRate = parseFloat(document.getElementById("power").value);
  const electricity = parseFloat(document.getElementById("electricity").value);
  const feePercent = parseFloat(document.getElementById("fee").value);
  const hardwareCost = parseFloat(document.getElementById("hardware_cost").value);
  const hours = parseFloat(document.getElementById("hours").value);

  const btcPrice = await fetchBTCPrice();
  const blockRewardBTC = 3.125;
  const blocksPerDay = 144;
  const networkHashrate = 500000000; // TH/s

  let userHashrate = hashrate;
  const unit = getHashrateUnit();
  if (unit === "GH/s") userHashrate *= 0.001;
  if (unit === "MH/s") userHashrate *= 0.000001;

  const userHashrateHps = userHashrate * 1e12;
  let dailyBTC = blockRewardBTC * blocksPerDay * (userHashrateHps / (networkHashrate * 1e12));
  dailyBTC *= (1 - feePercent / 100);

  const revenueBeforeFee = dailyBTC * btcPrice;
  const revenueAfterFee = revenueBeforeFee - (revenueBeforeFee * feePercent / 100);
  const powerInKW = powerRate * userHashrate;
  const dailyCost = powerInKW * hours * electricity;
  const dailyProfit = revenueAfterFee - dailyCost;
  latestProfitUsd = dailyProfit;

  const roi = dailyProfit > 0 ? Math.ceil(hardwareCost / dailyProfit) : null;
  currentROI = roi;

  document.getElementById("btc_price").textContent = btcPrice.toFixed(2);
  document.getElementById("daily_btc").textContent = dailyBTC.toFixed(8);
  document.getElementById("monthly_btc").textContent = (dailyBTC * 30).toFixed(8);
  document.getElementById("yearly_btc").textContent = (dailyBTC * 365).toFixed(8);
  document.getElementById("daily_rev").textContent = revenueAfterFee.toFixed(2);
  document.getElementById("daily_cost").textContent = dailyCost.toFixed(2);
  document.getElementById("daily_profit").textContent = dailyProfit.toFixed(2);
  document.getElementById("roi").textContent = roi ? roi : "수익 없음";

  document.getElementById("output").classList.add("show");

  drawChart(dailyProfit, hardwareCost, roi, dailyBTC);
}

function drawChart(dailyProfit, hardwareCost, roi, dailyBTC = 0) {
  const labels = [1, 7, 30, 100, 200, 300, 365];
  if (roi && !labels.includes(roi)) {
    labels.push(roi);
    labels.sort((a, b) => a - b);
  }

  const profits = labels.map(day => +(dailyProfit * day).toFixed(2));
  const investments = labels.map(() => hardwareCost);
  const btcAmounts = labels.map(day => +(dailyBTC * day).toFixed(8));

  const barColors = labels.map(day => {
    if (roi && day === roi) return "rgba(0, 255, 0, 1)";
    if (roi && day > roi) return "rgba(255, 99, 132, 0.8)";
    return "rgba(54, 162, 235, 0.6)";
  });

  const ctx = document.getElementById("profitChart").getContext("2d");
  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels.map(l => `${l}일`),
      datasets: [
        {
          type: 'line',
          label: "BTC 채굴량",
          data: btcAmounts,
          borderColor: "orange",
          backgroundColor: "rgba(255, 165, 0, 0.3)",
          yAxisID: 'y1',
          tension: 0.3,
          borderWidth: 3,
          zIndex: 100
        },
        {
          label: "순이익 ($)",
          data: profits,
          backgroundColor: barColors,
          yAxisID: 'y',
        },
        {
          label: "투자금 ($)",
          data: investments,
          backgroundColor: "rgba(128, 128, 128, 0.4)",
          yAxisID: 'y',
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        tooltip: {
          callbacks: {
            label: function(tooltipItem) {
              return tooltipItem.dataset.label === "순이익 ($)" ? `$${tooltipItem.raw}` : `$${tooltipItem.raw}`;
            }
          }
        },
        legend: {
          position: "top",
        }
      },
      scales: {
        y: {
          ticks: {
            beginAtZero: true,
            callback: value => `$${value}`
          }
        },
        y1: {
          position: "right",
          ticks: {
            callback: value => `${value} BTC`
          }
        }
      }
    }
  });
}

async function openModal() {
  const exchangeRate = await fetchExchangeRate();
  document.getElementById("exchangeRateDisplay").textContent = exchangeRate.toFixed(2);

  const daily = latestProfitUsd * exchangeRate;
  const monthly = daily * 30;
  const yearly = daily * 365;

  document.getElementById("dailyProfitKrw").textContent = Math.round(daily).toLocaleString('ko-KR');
  document.getElementById("monthlyProfitKrw").textContent = Math.round(monthly).toLocaleString('ko-KR');
  document.getElementById("yearlyProfitKrw").textContent = Math.round(yearly).toLocaleString('ko-KR');

  document.getElementById("exchangeModal").classList.add("open");
}

function closeModal() {
  document.getElementById("exchangeModal").classList.remove("open");
}

// 다크모드 토글
document.getElementById("darkToggle").addEventListener("change", function () {
  document.body.classList.toggle("dark-mode", this.checked);
});

// 설명 모달 열기
function showInfoModal(type) {
  let infoText = "";
  switch (type) {
    case 'electricity':
      infoText = "채굴에 필요한 1시간의 kw 전력 소비 비용을 의미합니다.";
      break;
    case 'power':
      infoText = "장비가 채굴을 위해 사용하는 1시간의 kw 전기의 양입니다.";
      break;
    case 'hours':
      infoText = "하루 중 채굴하는 시간을 설정합니다.";
      break;
    case 'fee':
      infoText = "채굴 풀에서 부과하는 수수료입니다.";
      break;
    case 'hardware_cost':
      infoText = "채굴에 필요한 장비에 투자한 가격입니다.";
      break;
    default:
      infoText = "정보를 불러올 수 없습니다.";
  }

  const modal = document.getElementById("infoModal");
  document.getElementById("infoText").textContent = infoText;
  modal.classList.add("show");
}

// 설명 모달 닫기
function closeInfoModal() {
  document.getElementById("infoModal").classList.remove("show");
}

</script>

</body>
</html>
